osx_image: xcode10.1
dist: trusty
sudo: false

language: node_js
node_js: "9.11.1"


before_install:
  - cd app

jobs:
  include:
    - stage: Test
      script: npm test
    - stage: Deploy
      env:
        global:
          - ELECTRON_CACHE=$HOME/.cache/electron
          - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder
      cache:
        directories:
          - app/node_modules
          - $HOME/.cache/electron
          - $HOME/.cache/electron-builder
          - $HOME/.npm/_prebuilds
      on:
        branch: master
      before_cache:
        - rm -rf $HOME/.cache/electron-builder/wine
      matrix:
        include:
          - os: osx
            script:
              - npm run release -- --mac --win
          - os: linux
            script:
              - npm run release
